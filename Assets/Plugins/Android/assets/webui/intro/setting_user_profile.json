{"title":"User Profile","scrolling":true,"loadflow":"","init":"\n$('body').addClass('textured');$('#header .loading').hide();$('.button').pretouch();if(OF.page.params.mode=='switch'){OF.introSwitch=true;}\nif(OF.introSwitch){$('.switch_flow').unhide(0);$('.intro_flow').hide();}\nOF.page.setMobile=function(mobile,show_password_tip){if(mobile.match(/^(134|135|136|137|138|139|150|151|152|157|158|159|187|188|182|130|131|132|155|156|185|186|133|153|180|189)(\\d){8}$/)){OF.loader.show();if(typeof(show_password_tip)!='undefined'){var tip=\"\u5bc6\u7801\u5df2\u8bbe\u7f6e,\u83b7\u53d6\u9a8c\u8bc1\u7801...\";}else{var tip=\"\u6b63\u5728\u83b7\u53d6\u9a8c\u8bc1\u7801...\";}\n$('#submit').html(tip);OF.api.request('/xp/users/current_user/set_mobile',{httpParams:{timeout:100000},method:'POST',params:{mobile_number:mobile},success:function(data){OF.loader.hide();OF.navigateToUrl('intro/set_mobile_verify_code');},failure:function(data,status){if(data.exception['class']==\"FailToSendVerifyCode\"){$('form').data('isLoading',false);$('#submit').html(\"\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5e76\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\");}\n$('#submit').html(\"\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5e76\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\");$('form').data('isLoading',false);OF.loader.hide();OF.alert(\"\u9519\u8bef\u63d0\u793a\",data.exception.message);}});}else{$('form').data('isLoading',false);OF.alert(\"\u63d0\u793a\",\"\u8bf7\u586b\u5199\u771f\u5b9e\u6709\u6548\u7684\u624b\u673a\u53f7\u7801\");}}\nOF.page.setPassword=function(password,mobile){if(password.length>=6){OF.loader.show();$('#submit').html(\"\u6b63\u5728\u8bbe\u7f6e\u5bc6\u7801...\");OF.api.request('/xp/users/'+OF.user.id,{method:'PUT',params:{user:{http_basic_credential_attributes:{password:password,password_confirmation:password}}},success:function(){if(typeof(mobile)!='undefined'){OF.page.setMobile(mobile,true);}else{OF.loader.hide();OF.alert('\u63d0\u793a',\"\u5bc6\u7801\u8bbe\u7f6e\u6210\u529f\");OF.navigateToUrl('dashboard/user');}},failure:function(data){OF.loader.hide();$('form').data('isLoading',false);$('#submit').html(\"\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5e76\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\");OF.alert(\"\u9519\u8bef\u63d0\u793a\",data.exception.message);}});}else{$('form').isLoading(false);OF.alert('\u63d0\u793a',\"\u5bc6\u7801\u8bbe\u7f6e\u8fc7\u77ed\uff0c\u81f3\u5c116\u4f4d\u6570\u5b57\u6216\u5b57\u6bcd\");}}\nif(OF.page.params.need_to_update_user){OF.api.request('/xp/users/'+OF.user.id,{method:'PUT',params:{user:{has_enter_mobile_page:true}}});}\nOF.page.updateSettingProfile=function(){var has_set_password=false;OF.api.request('/xp/users/'+OF.user.id,{method:'GET',params:{for_setting_user_page_optimization:true},success:function(data){$('.loading').hide();$('.intro_flow').unhide();$('#intro_login').unhide();has_set_password=data.user.has_set_password;if(has_set_password==true&&data.user.mobile_binding_status!='2'){$('.password').hide();$('form').isLoading(false);$('#submit').html('\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801');}else if(has_set_password==true&&data.user.mobile_binding_status=='2'){OF.navigateToUrl('dashboard/user');}else{$('.password').unhide();$('form').isLoading(false);$('#submit').html('\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5e76\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801');}\n$('#submit').touch(function(){if(!$('form').isLoading()){var mobile=$.trim($('#user_mobile_number').val());var password=$(\"#user_http_basic_credential_attributes_password\").val();$('input').blur();$('form').isLoading(true);if(mobile.length==0&&password.length==0&&has_set_password==false){$('form').isLoading(false);OF.alert(_('Missing Data'),\"\u5bc6\u7801\u548c\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u90fd\u4e3a\u7a7a\");}else if(mobile.length==0&&has_set_password==true){$('form').isLoading(false);OF.alert(_('Missing Data'),\"\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a\");}else if(mobile.length>0&&password.length==0){OF.page.setMobile(mobile);}else if(mobile.length==0&&password.length>0&&has_set_password==false){OF.page.setPassword(password);}else if(mobile.length>0&&password.length>0&&has_set_password==false){if(password.length<6){$('form').isLoading(false);OF.alert('\u63d0\u793a',\"\u5bc6\u7801\u8bbe\u7f6e\u8fc7\u77ed\uff0c\u81f3\u5c116\u4f4d\u6570\u5b57\u6216\u5b57\u6bcd\");}else if(mobile.match(/^(134|135|136|137|138|139|150|151|152|157|158|159|187|188|182|130|131|132|155|156|185|186|133||153|180|189)(\\d){8}$/)==null){$('form').isLoading(false);OF.alert(\"\u63d0\u793a\",\"\u8bf7\u586b\u5199\u771f\u5b9e\u6709\u6548\u7684\u624b\u673a\u53f7\u7801\");}else{OF.page.setPassword(password,mobile);}}}});if(data.user.has_enter_mobile_page==false){OF.api.request('/xp/users/'+OF.user.id,{method:'PUT',params:{user:{has_enter_mobile_page:true}}});}}});}\nOF.page.updateSettingProfile();$('form').submit(function(){$('#submit').touch();return false;});$(\"#start_game\").touch(function(){$(this).html(\"\u6b63\u5728\u8fdb\u5165...\");OF.navigateToUrl('dashboard/user');});","resume":"\n$('form').isLoading(false);$('.loading').unhide();$('#intro_flow').hide();$('#intro_login').hide();$(\"#start_game\").html('\u53bb\u4e5d\u57ce\u6e38\u620f\u4e2d\u5fc3');OF.page.updateSettingProfile();","appear":"","html":"<div id='intro'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n</div>\n<div class='content'>\n<div class='intro_flow hidden'>\n<p>\n<span class='login_reminder'>\n\u4e3a\u4e86\u4fdd\u62a4\u60a8\u7684\u5e10\u53f7\u4fe1\u606f\u5b89\u5168\uff0c\u66f4\u4fbf\u6377\u7684\u5728\u5176\u4ed6\u624b\u673a\u4e0a\u4f7f\u7528\u4e5d\u57ce\u6e38\u620f\u4e2d\u5fc3\u7684\u5e10\u6237\u3002\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u9a6c\u4e0a\u5b8c\u5584\u76f8\u5173\u4e2a\u4eba\u8d44\u6599\u8bbe\u7f6e\u3002\n</span>\n</p>\n</div>\n<div class='cell loading'>\n<div class='spinner'></div>\n</div>\n<div class='hidden' id='intro_login'>\n<form>\n<div class='input_field password'>\n<label>\u8bbe\u7f6e\u767b\u5f55\u5bc6\u7801:</label>\n<input id='user_http_basic_credential_attributes_password' name='user[http_basic_credential_attributes][password]' type='password'>\n</div>\n<div class='input_field'>\n<label>\u7ed1\u5b9a\u60a8\u7684\u624b\u673a\u53f7\u7801:</label>\n<input id='user_mobile_number' name='user[mobile_number]' type='text'>\n</div>\n</form>\n<p>\n\u8bf4\u660e\uff1a\u6211\u4eec\u5c06\u5411\u60a8\u7684\u624b\u673a\u53d1\u9001\u4e00\u6761\u9a8c\u8bc1\u7801\u77ed\u4fe1\uff0c\u6b64\u670d\u52a1\u5b8c\u5168\u514d\u8d39\u3002\n</p>\n<div class='button default' id='submit' style='line-height:24px'>\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5e76\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801</div>\n<div class='button' id='start_game' style='line-height:32px'>\u53bb\u4e5d\u57ce\u6e38\u620f\u4e2d\u5fc3</div>\n</div>\n\n</div>\n<div id='footer'></div>\n</div>\n"}