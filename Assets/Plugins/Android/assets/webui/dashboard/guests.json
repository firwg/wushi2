{"title":"\u7559\u8a00\u677f","scrolling":true,"loadflow":"","init":"\nOF.setActiveFootermenu();OF.setFootermenu();$('body').addClass('textured');$('.button').pretouch();if(!OF.friendsList){OF.friendsList={init:function(){$('#friends').data('total_pages',1);$('#friends').data('next_page',1);$('#friends').data('is_loading_more',false);$('#load_more').hide();$('#friends_list > ul .user').remove();$('#friends ul#loading').unhide();OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}else{$(\"#load_more\").unhide();}\n$(\"#friends ul#loading\").hide();});},load_more:function(){if(!$('#friends').data('is_loading_more')){$('#friends').data('is_loading_more',true);$(\"#load_more\").html(\"\u8bfb\u53d6\u4e2d....\");OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}\n$(\"#load_more\").html(\"\u8bfb\u53d6\u66f4\u591a\");$('#friends').data('is_loading_more',false);});}},load_data:function(callback){OF.api.request('/xp/friends',{params:{user_id:OF.page.user.id,page:$('#friends').data('next_page'),per_page:10,for_friends_list_page_optimization:true},success:function(data){if($('#friends').data('next_page')==1){OF.friendsList.renderFriends(data.users);$('#friends').data('total_pages',data.total_pages);}else{OF.friendsList.addFriends(data.users);}\n$('#friends').data('next_page',$('#friends').data('next_page')+1);callback();}});},renderFriendItems:function(friends){var html=$.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));$(\"#friends_list .no_data\").hide();}else{$('#friends_list > ul').hide();$(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));}};}\n$('#home_button').touch(OF.menu.home);OF.page.user=OF.page.params.user||{id:OF.page.params.user_id||OF.user.id};var guestTmpl=tmpl('guest_entry');var total_pages=1;var total_entries=0;var next_page=2;var is_loading_more=false;if(OF.page.user.name){$('.section_title.top').html(OF.page.user.name+\"\u7684\u7559\u8a00\u677f\uff08\u5171<span id='total_entry_title'>0</span>\u6761\uff09\");}else{OF.api.request('/xp/users/'+OF.page.user.id,{method:'GET',success:function(data){OF.page.user=data.user;$('.section_title.top').html(OF.page.user.name+\"\u7684\u7559\u8a00\u677f\uff08\u5171<span id='total_entry_title'>0</span>\u6761\uff09\");}});}\nvar isLocalUser=OF.user==OF.page.user;if(isLocalUser){$(\"#guest_is_private\").hide();$(\"#guest_is_private_label\").hide();}\nOF.api.request(\"/xp/users/\"+OF.page.user.id+\"/guests\",{method:'GET',success:function(data){var guests=data.guests;total_entries=parseInt(data.total_entries);total_pages=parseInt(data.total_pages);$('#total_entry_title').html(total_entries);applyingGuestTmpl(guests);},failure:function(){alert('failed!');}});function applyingGuestTmpl(guests){var content=[];$.each(guests,function(){if(parseInt(this.is_private)==1&&(parseInt(this.from_id)!=parseInt(OF.user.id)&&!isLocalUser)){}else if(parseInt(this.is_private)==1&&(parseInt(this.from_id)==parseInt(OF.user.id)||isLocalUser)){this.message=\"<span class='private'>\"+this.message+\"</span>\"\ncontent.push(guestTmpl(this));}else{content.push(guestTmpl(this));}});$(content.join(\" \")).insertBefore($(\"#load_more\"));if(total_entries>10){$(\"#load_more\").unhide();}\nif(isLocalUser){$(\".reply\").show();$(\".delete\").show();}}\n$(\"#load_more\").touch(function(){if(!is_loading_more){is_loading_more=true;$(\"#load_more\").html(\"\u8bfb\u53d6\u4e2d....\");OF.api.request(\"/xp/users/\"+OF.page.user.id+\"/guests\",{method:'GET',params:{page:next_page},success:function(data){var guests=data.guests;applyingGuestTmpl(guests);next_page+=1;if(next_page>total_pages){$(\"#load_more\").hide();}\n$(\"#load_more\").html(\"\u8bfb\u53d6\u66f4\u591a\");is_loading_more=false;},failure:function(){alert('failed!');}});}});$(\".delete\").touch(function(){var obj=$(this);var message_id=obj.attr(\"message_id\");OF.api.request(\"/xp/users/\"+OF.page.user.id+\"/guests/\"+message_id,{method:'DELETE',success:function(){obj.parents(\"li\").fadeOut();total_entries-=1;$(\"#total_entry_title\").html(total_entries);OF.alert(\"\u63d0\u793a\uff1a\",\"\u7559\u8a00\u5220\u9664\u6210\u529f\u3002\");}});});$(\"#submit.button\").touch(function(){if(!$(\"#guest_book_form\").isLoading()){var message=$(\"#guest_message\").val();var is_private=$(\"#guest_is_private\").attr(\"checked\")==true?1:0;if(message.length>70){OF.alert(\"\u9519\u8bef\u63d0\u793a\uff1a\",\"\u7559\u8a00\u5185\u5bb9\u4e0d\u5f97\u8d85\u8fc770\u4e2a\u5b57\u3002\");}else if(message.length==0){OF.alert(\"\u9519\u8bef\u63d0\u793a\uff1a\",\"\u8bf7\u8f93\u5165\u4f60\u7684\u7559\u8a00\u5185\u5bb9\u3002\");}else{$(\"#guest_book_form\").isLoading(true);$(\"#submit.button\").html(\"\u6b63\u5728\u53d1\u5e03....\");OF.api.request(\"/xp/users/\"+OF.page.user.id+\"/guests\",{method:'POST',params:{guest:{message:message,is_private:is_private,from_id:OF.user.id}},success:function(data){var a_guest=data.guest;$(\"#guest_message\").val(\"\");if(parseInt(a_guest.is_private)==1){a_guest.message=\"<span class='private'>\"+a_guest.message+\"</span>\"}\n$(guestTmpl(a_guest)).insertAfter($(\"#list_section\"));total_entries+=1;$(\"#total_entry_title\").html(total_entries);if(isLocalUser){$(\".reply\").show();$(\".delete\").show();}\n$(\"#guest_book_form\").isLoading(false);$(\"#submit.button\").html(\"\u53d1\u5e03\");},on404:function(data){$(\"#submit.button\").html(\"\u53d1\u5e03\");},failure:function(data){$(\"#guest_book_form\").isLoading(false);alert(data.exception.message);$(\"#submit.button\").html(\"\u53d1\u5e03\");}});}}});$(\"#guest_is_private_label\").touch(function(){if($(\"#guest_is_private\").attr(\"checked\")==true){$(\"#guest_is_private\").attr(\"checked\",false);}else{$(\"#guest_is_private\").attr(\"checked\",true);}});","resume":"\nOF.setActiveFootermenu();","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"guest_entry\">\n            <%\n    var style = \"\";\n    if (user_icon) {\n      style = \"background-image: url(\" + user_icon + \")\";\n    }\n  %>\n  <li class=\"user entry\" >\n    <div class=\"image avatar\" style=\"<%= style %>\" data-href=\"dashboard/user?user_id=<%= from_id %>\" >\n      <div class=\"overlay\"></div>\n    </div>\n    <div class=\"title user_name\" data-href=\"dashboard/user?user_id=<%= from_id %>\" ><%= user_name %>\n      <input type=\"button\" message_id=\"<%= id %>\" style=\"display: none\" value=\"\u5220\u9664\" class=\"delete\">\n      <input type=\"button\" data-href=\"dashboard/user?user_id=<%= from_id %>\" message_id=\"<%= id %>\" style=\"display: none\" value=\"\u56de\u590d\" class=\"reply\">\n    </div>\n    <div class=\"message\"><%= message %></div>\n    <div class=\"datetime\"><%= created_at %></div>\n  </li>\n          </script>\n<div id='guest_book'>\n<ul class='cells'>\n<li class='section_title top'>\u7559\u8a00\u677f</li>\n</ul>\n<form id='guest_book_form'>\n<div class='input_field'>\n<label class='t' id='guest_book_label'>\u4f60\u7684\u7559\u8a00\uff1a</label>\n<input id='guest_message' name='message' type='text'>\n<input id='guest_is_private' type='checkbox' value='1'>\n<span id='guest_is_private_label'>\u6084\u6084\u8bdd</span>\n</div>\n<div class='button default t' id='submit'>\u53d1\u5e03</div>\n</form>\n<ul class='cells' id='guest_list'>\n<li class='section_title' id='list_section'></li>\n<li class='load_more hidden' id='load_more'>\u8bfb\u53d6\u66f4\u591a</li>\n</ul>\n</div>\n\n<br clear='both'>\n<div id='footer'>\n<div class='footer_menu' id='footer_menu_for_2_1' style='display:none'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n<br clear='both'>\n<div class='footer_menu' id='footer_menu_for_2_2'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n"}