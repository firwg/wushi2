
var OF,_,jQuery,$,tmpl;var U=_.noConflict();jQuery.fn.unhide=function(fadeSpeed){$(this).removeClass('hidden').hide().fadeIn(fadeSpeed);return $(this);};jQuery.fn.isLoading=function(value){return $(this).data('isLoading',value);};jQuery.fn.isFormFilled=function(failureMessage){var valid=true;$(this).find(':input').each(function(index,field){if(field.value.length===0){OF.alert(_('Missing Data'),failureMessage?failureMessage:_('Please fill out all form fields.'));valid=false;return false;}});return valid;};jQuery.lazyLoad=function(options){var self=OF.page.eventHandle();var startPage=options.startPage||1;var threshold=options.threshold||0.5;var nextPageLoaded=options.nextPageLoaded;var nextPageShouldLoad=options.nextPageShouldLoad;var isEmpty=options.isEmpty;var isFinished=options.isFinished;var pageHandler=function(page,data,forceFinish){var finished=forceFinish||data.length===0;if(finished){if(page===1&&isEmpty){isEmpty();}
if(isFinished){isFinished();}
$(self).unbind("scroll.lazyLoader");}
if(data.length>0){nextPageLoaded(page,data);}
$(self).data("lazyLoader-lastLoadedPage",page);$.defer(function(){$(self).data("lazyLoader-isLoading",false);});};$(self).data("lazyLoader-isLoading",true);nextPageShouldLoad(startPage,pageHandler.curry(startPage));$(self).bind("scroll.lazyLoader",function(){var scrollBottom=$(document).scrollTop()+$(window).height();var triggerLine=$(document).height()-($(window).height()*threshold);if(scrollBottom<triggerLine){return;}
if($(self).data("lazyLoader-isLoading")){return;}
var nextPage=($(self).data("lazyLoader-lastLoadedPage")||startPage)+1;$(self).data("lazyLoader-isLoading",true);nextPageShouldLoad(nextPage,pageHandler.curry(nextPage));});};jQuery.defer=function(js){var args=Array.prototype.slice.call(arguments);args.shift();setTimeout(function(){$.functionize(js,'anonymous','defer').apply(null,args);},0);};jQuery.clone=function(obj){return $.extend({},obj);};jQuery.profile=function(name,fn){var start=new Date();var retVal=fn();var end=new Date();OF.log('JS PROFILE:'+name+' - '+(end-start)+'ms');return retVal;};jQuery.urlEncode=function(options,prefix){var result='';if(options){var values=[];for(var key in options){if(options[key]!==null){var paramName=prefix?prefix+"["+key+"]":key;var value=options[key];if($.isPlainObject(value)){values.push($.urlEncode(value,paramName));}else{values.push(paramName+'='+encodeURIComponent(value));}}}
result=values.join('&');}
return result;};jQuery.urlDecode=function(queryString){if(!queryString){return{};}
queryString=queryString.replace(/^\?/,'');var result={};var pairs=queryString.split('&');$.each(pairs,function(){var pair=this.split('=');result[pair[0]]=decodeURIComponent(pair[1]);});return result;};jQuery.htmlEncode=function(value){return $('<div/>').text(value).html();};jQuery.htmlDecode=function(value){return $('<div/>').html(value).text();};jQuery.functionize=function(js,file,name){if($.isFunction(js)){return js;}
else if(typeof js==='string'){if(js.match(/^\s*function/)){js=['(',js,')'].join('');}else{js=['(function() {',js,'})'].join('');}
try{return eval(js);}catch(e){throw(e.toString()+' in '+$.functionize.errorLocation(file,name));}}else{throw('ERROR: '+$.functionize.errorLocation(file,name)+' Must be a string or function but was: '+js);}};jQuery.functionize.errorLocation=function(file,name){return[file.replace('.json',''),':',name].join('');};jQuery.random=function(min,max){return Math.floor(Math.random()*(max+1-min))+min;};jQuery.jsonifyUrl=function(url){if(!url.match(/\.json/)){if(url.match(/\?/)){url=url.replace(/\?/,'.json?');}else{url+='.json';}}
return url;};jQuery.renderCollection=function(partialName,items,innerKey){if(items.length===0){return'';}
var theTmpl=tmpl(partialName);var html=[];if(!innerKey){var keys=[];for(var k in items[0]){if(items[0].hasOwnProperty(k)){keys.push(k);}}
if(keys.length>1){OF.log('ERROR: Ambiguous inner keys ['+keys.join(', ')+']. Specify what key to use if there is more than one.');return;}
if(keys.length===0){OF.log('ERROR: Cannot render empty object.');}
innerKey=keys[0];}
var index=0;$.each(items,function(){var obj=this[innerKey];if(!obj.index){obj.index=index;}
if(!obj.position){obj.position=obj.index+1;}
index+=1;html.push(theTmpl(obj));});return $(html.join(''));};jQuery.loadScript=function(path){$.ajax({url:['javascripts/',path,'.js?',new Date().getTime()].join(''),dataType:'script',async:false});};jQuery.loadCss=function(path,async){$.ajax({url:['stylesheets/',path,'.css?',new Date().getTime()].join(''),async:typeof(async)==='undefined'?true:async,success:function(data){$('<style></style>').attr('type','text/css').attr('id',path+'_css').html(data).appendTo('head');}});};jQuery.ensureUpdate=function(selector,fn){fn();var html=$(selector).html();if(html===null||$.trim(html).length===0){setTimeout(function(){jQuery.ensureUpdate(selector,fn);},100);}};jQuery.deprecate=function(fn,oldName,newName){return function(){OF.log("DEPRECATION WARNING: "+oldName+" has been replaced by "+newName);return fn.apply(null,arguments);};};jQuery.fn.hasLive=function(type,ctx){if(!ctx){ctx=document;}
var data=$.data(ctx);if(data&&data.events&&data.events[type]){var evts=data.events[type];for(var i=0,len=evts.length;i<len;i++){if(this.is(evts[i].selector)){return true;}}}
return false;};Function.prototype.curry=function(){if(!arguments.length){return this;}
var theMethod=this,args=Array.prototype.slice.call(arguments,0);return function(){var a=$.merge(args,arguments);return theMethod.apply(this,a);};};String.prototype.cnLen=function(){return this.replace(/[^\x00-\xff]/g,"**").length;}