{"title":"\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b","scrolling":true,"loadflow":"","init":"\nOF.setActiveFootermenu();OF.setFootermenu();$('body').addClass('textured');$('.button').pretouch();if(!OF.friendsList){OF.friendsList={init:function(){$('#friends').data('total_pages',1);$('#friends').data('next_page',1);$('#friends').data('is_loading_more',false);$('#load_more').hide();$('#friends_list > ul .user').remove();$('#friends ul#loading').unhide();OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}else{$(\"#load_more\").unhide();}\n$(\"#friends ul#loading\").hide();});},load_more:function(){if(!$('#friends').data('is_loading_more')){$('#friends').data('is_loading_more',true);$(\"#load_more\").html(\"\u8bfb\u53d6\u4e2d....\");OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}\n$(\"#load_more\").html(\"\u8bfb\u53d6\u66f4\u591a\");$('#friends').data('is_loading_more',false);});}},load_data:function(callback){OF.api.request('/xp/friends',{params:{user_id:OF.page.user.id,page:$('#friends').data('next_page'),per_page:10,for_friends_list_page_optimization:true},success:function(data){if($('#friends').data('next_page')==1){OF.friendsList.renderFriends(data.users);$('#friends').data('total_pages',data.total_pages);}else{OF.friendsList.addFriends(data.users);}\n$('#friends').data('next_page',$('#friends').data('next_page')+1);callback();}});},renderFriendItems:function(friends){var html=$.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));$(\"#friends_list .no_data\").hide();}else{$('#friends_list > ul').hide();$(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));}};}\n$('#home_button').touch(OF.menu.home);var userID=OF.page.params.user_id||OF.user.id;var gameID=OF.page.params.game_id||OF.game.id;var leaderboardID=OF.page.params.leaderboard_id;var stage=OF.page.params.stage;OF.page.params.show_blobs=(gameID===OF.game.id);var scoreTmpl=tmpl('score_tmpl');var everyoneRequest=null;var myScoreRequest=null;var friendScoreRequest=null;function curDateTime(){var d=new Date();var year=d.getFullYear();var month=d.getMonth()+1;var date=d.getDate();var day=d.getDay();var hours=d.getHours();var minutes=d.getMinutes();var seconds=d.getSeconds();var ms=d.getMilliseconds();var curDateTime=year;if(month>9)\ncurDateTime=curDateTime+\"-\"+month;else\ncurDateTime=curDateTime+\"-0\"+month;if(date>9)\ncurDateTime=curDateTime+\"-\"+date;else\ncurDateTime=curDateTime+\"-0\"+date;if(hours>9)\ncurDateTime=curDateTime+\" \"+hours;else\ncurDateTime=curDateTime+\" 0\"+hours;if(minutes>9)\ncurDateTime=curDateTime+\":\"+minutes;else\ncurDateTime=curDateTime+\":0\"+minutes;if(seconds>9)\ncurDateTime=curDateTime+\":\"+seconds;else\ncurDateTime=curDateTime+\":0\"+seconds;return curDateTime;}\nvar myTimeNow=curDateTime();console.log(myTimeNow);if(myTimeNow<\"2011-07-31 23:59:59\"){$(\".tianyi_title\").text(\"\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b8\u67081\u65e5\u5373\u5c06\u5f00\u59cb\uff0c\u5c3d\u8bf7\u671f\u5f85\uff01\");}else if(myTimeNow>\"2011-08-01 00:00:01\"&&myTimeNow<\"2011-08-06 23:59:59\"){$(\".tianyi_title\").text(\"\u5929\u7ffc\u5927\u8d5b\u70ed\u8eab\u8d5b\u9636\u6bb5[8\u67081\u65e5\uff0d8\u67087\u65e5]\u706b\u70ed\u8fdb\u884c\u4e2d\");}else if(myTimeNow>\"2011-08-07 00:00:00\"&&myTimeNow<\"2011-08-07 23:59:59\"){$(\".tianyi_title\").text(\"\u5929\u7ffc\u5927\u8d5b\u9884\u8d5b\u9636\u6bb58\u67088\u65e5\u5f00\u59cb\uff0c\u5feb\u6765\u53c2\u4e0e\u5427\uff01\");}else if(myTimeNow>\"2011-08-08 00:00:00\"&&myTimeNow<\"2011-09-09 23:59:59\"){$(\".tianyi_title\").text(\"\u624b\u6e38\u5927\u8d5b\u9884\u8d5b\u9636\u6bb5[8\u67088\u65e5\uff0d9\u67089\u65e5]\u706b\u70ed\u8fdb\u884c\u4e2d\");}else if(myTimeNow>\"2011-09-10 00:00:00\"&&myTimeNow<\"2011-09-10 23:59:59\"){$(\".tianyi_title\").text(\"\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\u51b3\u8d5b\u9636\u6bb59\u670811\u65e5\u706b\u7206\u5f00\u542f\uff0c\u534e\u4e3dPK\u4e00\u89e6\u5373\u53d1\uff01\");}else if(myTimeNow>\"2011-09-11 00:00:00\"&&myTimeNow<\"2011-09-14 23:59:59\"){$(\".tianyi_title\").text(\"\u624b\u6e38\u5927\u8d5b\u51b3\u8d5b\u9636\u6bb5[9\u670811\u65e5\uff0d9\u670815\u65e5]\u706b\u70ed\u8fdb\u884c\u4e2d\uff0c\u4e3a\u624b\u673a\u6e38\u620f\u8fbe\u4eba\u52a9\u5a01\u5427\uff01\");}else if(myTimeNow>\"2011-09-15 00:00:00\"){$(\".tianyi_title\").text(\"\u624b\u6e38\u5927\u8d5b\u6700\u540e\u7ed3\u679c\u516c\u5e03\uff0c\u638c\u58f0\u732e\u7ed9\u6e38\u620f\u8fbe\u4eba\uff01\");};var load=function(interval,tab){$(tab).addClass(\"active\");if(everyoneRequest)everyoneRequest.cancel();if(myScoreRequest)myScoreRequest.cancel();if(friendScoreRequest)friendScoreRequest.cancel();$(\"section.scores\").addClass(\"hidden\");$(\"section.scores ul\").remove();$(\"#no_data\").addClass(\"hidden\").hide();$(\".loading\").show();var rankScores=function(scores){var rank=0;$.each(scores,function(){if(!this.activity_high_score.rank)this.activity_high_score.rank=++rank;});}\nvar renderScores=function(scoresObject,tab){$(\"#you\").unhide();if(myTimeNow>\"2011-07-28 00:00:00\"&&myTimeNow<\"2011-07-31 23:59:59\"||myTimeNow>\"2011-08-07 00:00:00\"&&myTimeNow<\"2011-08-07 23:59:59\"||myTimeNow>\"2011-09-10 00:00:00\"&&myTimeNow<\"2011-09-10 23:59:59\"){$(\"#you\").hide();}\n$('.loading').hide();if(scoresObject.you==null||scoresObject.you.length==0){OF.api.request('/xp/activity_leaderboards/'+userID+'/get_user_mobile_status',{success:function(data){if(myTimeNow>\"2011-09-11 00:00:00\"){OF.api.request('/xp/activity_leaderboards/user_id/'+userID+'/leaderboard_id/'+leaderboardID+'/get_user_juesaizige',{success:function(data){if(data.zige==true){$(\"#you\").append(\"<p style='color:#fff'>\u53c2\u4e0e10\u5f3aPK\u51b3\u8d5b\u83b7\u5f97\u624b\u673a\u6e38\u620f\u8fbe\u4eba\u8363\u8a89\uff0c\u5feb\u4e0a\u4f20\u5206\u6570\uff01</p>\");}else{$(\"#you\").append(\"<p style='color:#fff'>\u8bf7\u4e3a10\u5f3a\u9009\u624b\u559d\u5f69\uff01</p>\");}}});}else{if(data.mobile_binding_status==2){if(leaderboardID==916949672){$(\"#you\").append(\"<p style='color:#fff'>\u6210\u529f\u4e0a\u4f20\u8d85\u70ab3D\u96a7\u9053\uff08\u5b8c\u7f8e\u7248\uff09\u56f0\u96be\u6a21\u5f0f\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916947752){$(\"#you\").append(\"<p style='color:#fff'>\u6210\u529f\u4e0a\u4f20\u75af\u72c2\u7684\u62f3\u5934\uff08\u5b8c\u7f8e\u7248\uff09\u666e\u901a\u6a21\u5f0f\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916950532){$(\"#you\").append(\"<p style='color:#fff'>\u6210\u529f\u4e0a\u4f20\u5929\u7ffc\u6218\u673a\uff08\u521d\u8d5b\u7248\uff09\u9884\u8d5b\u6392\u884c\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916950862){$(\"#you\").append(\"<p style='color:#fff'>\u6210\u529f\u4e0a\u4f20\u5929\u7ffc\u6218\u673a\uff08\u51b3\u8d5b\u7248\uff09\u51b3\u8d5b\u6392\u884c\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916946462){$(\"#you\").append(\"<p style='color:#fff'>\u6210\u529f\u4e0a\u4f20\u4fc4\u7f57\u65af\u65b9\u5757\u6700\u7ec8\u79ef\u5206\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");};}else{if(leaderboardID==916949672){$(\"#you\").append(\"<p style='color:#fff'>\u7ed1\u5b9a\u624b\u673a\u53f7,\u5e76\u6210\u529f\u4e0a\u4f20\u8d85\u70ab3D\u96a7\u9053\uff08\u5b8c\u7f8e\u7248\uff09\u56f0\u96be\u6a21\u5f0f\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916947752){$(\"#you\").append(\"<p style='color:#fff'>\u7ed1\u5b9a\u624b\u673a\u53f7,\u5e76\u6210\u529f\u4e0a\u4f20\u75af\u72c2\u7684\u62f3\u5934\uff08\u5b8c\u7f8e\u7248\uff09\u666e\u901a\u6a21\u5f0f\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916950532){$(\"#you\").append(\"<p style='color:#fff'>\u7ed1\u5b9a\u624b\u673a\u53f7,\u5e76\u6210\u529f\u4e0a\u4f20\u5929\u7ffc\u6218\u673a\uff08\u521d\u8d5b\u7248\uff09\u9884\u8d5b\u6392\u884c\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916950862){$(\"#you\").append(\"<p style='color:#fff'>\u7ed1\u5b9a\u624b\u673a\u53f7,\u5e76\u6210\u529f\u4e0a\u4f20\u5929\u7ffc\u6218\u673a\uff08\u51b3\u8d5b\u7248\uff09\u51b3\u8d5b\u6392\u884c\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");}else if(leaderboardID==916946462){$(\"#you\").append(\"<p style='color:#fff'>\u7ed1\u5b9a\u624b\u673a\u53f7,\u5e76\u6210\u529f\u4e0a\u4f20\u4fc4\u7f57\u65af\u65b9\u5757\u6700\u7ec8\u79ef\u5206\u699c\u5355\u7684\u5206\u6570\u5c31\u80fd\u53c2\u52a0\u5929\u7ffc\u7a7a\u95f4\u624b\u6e38\u5927\u8d5b\uff0c\u8d76\u5feb\u884c\u52a8\u5427\uff01</p>\");};}}}});}\nif(tab=='#everyone_tab'){$(\"#everyone\").unhide();if(myTimeNow>\"2011-07-28 00:00:00\"&&myTimeNow<\"2011-07-31 23:59:59\"||myTimeNow>\"2011-08-07 00:00:00\"&&myTimeNow<\"2011-08-07 23:59:59\"||myTimeNow>\"2011-09-10 00:00:00\"&&myTimeNow<\"2011-09-10 23:59:59\"){$(\"#everyone\").hide();}\n$(\"#your_friends\").hide();if(scoresObject.everyone==null||scoresObject.everyone.length==0){$(\"#everyone\").append(\"<p style='color:#fff'>\u8be5\u6392\u884c\u699c\u6682\u65e0\u5206\u6570</p>\");}}\n$.each(scoresObject,function(section,scores){if(scores.length==0||scores==null){return;}\nvar html='';$.each(scores,function(){if(this.activity_high_score.display_text&&$.trim(this.activity_high_score.display_text).length>0){this.activity_high_score.display_score=this.activity_high_score.display_text;}else{this.activity_high_score.display_score=this.activity_high_score.score;}\nhtml+=scoreTmpl(this.activity_high_score);});var ul=$(\"<ul class='cells scores' id='score_list'>\").html(html);$('#'+section).append(ul).unhide();});}\nvar checkForData=function(tab){if(tab=='#everyone_tab'){scores.your_friends=[];}\nrenderScores(scores,tab);}\nvar baseParams=function(){interval>0?{interval:interval}:{};}\nvar scores={everyone:null,your_friends:null,you:null,};if(tab==\"#everyone_tab\"){everyoneRequest=OF.api.request('/xp/activity_leaderboards/'+leaderboardID+'/activity_high_scores',{success:function(data){rankScores(data.activity_high_scores);scores.everyone=data.activity_high_scores;myScoreRequest=OF.api.request('/xp/users/'+userID+'/games/'+gameID+'/activity_leaderboards/'+leaderboardID+'/current_score',{success:function(d){scores.you=[d];checkForData(tab);},failure:function(){scores.you=[];checkForData(tab);},params:$.extend(baseParams(),{friends_leaderboard:false})});},failure:function(){scores.everyone=[];checkForData(tab);},params:baseParams(),});}}\nOF.page.initTabs=function(){load(0,\"#everyone_tab\");};OF.page.initTabs();OF.page.score_page=1;OF.page.per_page=10;OF.page.scores=[];OF.page.sendScoresRequest=function(){OF.api.request('/xp/activity_scores',{params:{page:OF.page.score_page,per_page:OF.page.per_page,leaderboard_id:leaderboardID,stage:stage},success:function(data){OF.page.score_page=OF.page.score_page+1;var html='';if(data.scores.length>0){$('#more_scores').unhide();$.each(data.scores,function(i){OF.page.scores.push(data.scores[i]);this.activity_high_score.rank=(25+(OF.page.score_page-3)*OF.page.per_page+i+1);if(this.activity_high_score.display_text&&$.trim(this.activity_high_score.display_text).length>0){this.activity_high_score.display_score=this.activity_high_score.display_text;}else{this.activity_high_score.display_score=this.activity_high_score.score;}\nhtml+=scoreTmpl(this.activity_high_score);});$('#everyone #score_list').append(html);$('#more_scores').html('\u67e5\u770b\u66f4\u591a\u6392\u540d').touch(function(){$('#more_scores').html('\u6b63\u5728\u52a0\u8f7d\u6392\u540d...').touch(function(){return true;});OF.page.sendScoresRequest();});}else{$('#more_scores').css({'opacity':'0.7'}).html('\u5df2\u52a0\u8f7d\u5168\u90e8\u7684\u6392\u540d\uff01\uff01\uff01').touch(function(){return true;});}}});}\nOF.page.sendScoresRequest();","resume":"\nOF.setActiveFootermenu();","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"score_tmpl\">\n            <li class=\"high_score\" data-href=\"dashboard/user?user_id=<%= user.id %>\"<% if((typeof blob_url != \"undefined\") && OF.page.params.show_blobs) {%> style=\"margin-right:70px\"<% } %>>\n  <div class=\"icon\" <% if (user.profile_picture_url) { %> style=\"background-image: url(<%= user.profile_picture_url %>)\" <% } %>>\n    <div class=\"overlay\"></div>\n  </div>\n  <div class=\"title\">\n    <% if (typeof rank != \"undefined\" && (rank == '1' || rank == '2' || rank == '3')) { %>\n      <p class=\"leaderboard_rank leaderboard_rank_<%= rank %>\" style=\"margin:0px\"><span class=\"user_name truncate\"><%= user.name %></span></p>\n    <% }else if(typeof rank != \"undefined\") { %>\n      <span class=\"rank\"><%= rank %></span>\n      <span class=\"user_name truncate\"><%= user.name %></span>\n    <% } %>\n    <div class=\"subtitle\" style=\"line-height: 30px\">\n      <span class=\"experience_level\">Lv<%= user.experience_level %></span>\n      <span id=\"gem_icon\">\n      <img height=\"20\" width=\"20\" src=\"images/icon.brisks.level.<%= user.experience_level %>.png\">\n      </span>\n      <span style=\"float:right;\"><%= display_score %></span>\n    </div>\n    <div class=\"subtitle\">\u4e0a\u4f20\u65f6\u95f4: <%= updated_at %></div>\n  </div>\n</li>\n          </script>\n<!-- /  <% if((typeof blob_url != \"undefined\") && OF.page.params.show_blobs) { %> -->\n<!-- /    <li class=\"icon high_score_blob_icon\" data-high_score='<%= JSON.stringify({high_score: obj}) %>'> -->\n<!-- /      <div class=\"button\"> -->\n<!-- /        <div class=\"icon\"/> -->\n<!-- /      </div> -->\n<!-- /    </li> -->\n<!-- /  <% } %> -->\n<div id='leaderboard'>\n<section>\n<h3 class='tianyi_title' style='font-size:14px;color:black;'></h3>\n</section>\n<section class='scores hidden' id='you'>\n<h3 class='section_title'>\u6211\u7684\u6392\u540d</h3>\n</section>\n<section class='scores hidden' id='everyone'>\n<h3 class='section_title'>\u6240\u6709\u4eba\u7684\u6392\u884c\u699c</h3>\n</section>\n<div class='hidden button' id='more_scores' style='line-height:30px;height:50px;width:100%;text-align:center;margin-top:0px'>\n\u67e5\u770b\u66f4\u591a\u6392\u540d\n</div>\n<div class='cell loading'>\n<div class='spinner'></div>\n</div>\n</div>\n\n<br clear='both'>\n<div id='footer'>\n<div class='footer_menu' id='footer_menu_for_2_1' style='display:none'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n<br clear='both'>\n<div class='footer_menu' id='footer_menu_for_2_2'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n"}