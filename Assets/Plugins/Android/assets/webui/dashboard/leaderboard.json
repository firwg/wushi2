{"title":"Leaderboards","scrolling":true,"loadflow":"","init":"\nOF.setActiveFootermenu();OF.setFootermenu();$('body').addClass('textured');$('.button').pretouch();if(!OF.friendsList){OF.friendsList={init:function(){$('#friends').data('total_pages',1);$('#friends').data('next_page',1);$('#friends').data('is_loading_more',false);$('#load_more').hide();$('#friends_list > ul .user').remove();$('#friends ul#loading').unhide();OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}else{$(\"#load_more\").unhide();}\n$(\"#friends ul#loading\").hide();});},load_more:function(){if(!$('#friends').data('is_loading_more')){$('#friends').data('is_loading_more',true);$(\"#load_more\").html(\"\u8bfb\u53d6\u4e2d....\");OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}\n$(\"#load_more\").html(\"\u8bfb\u53d6\u66f4\u591a\");$('#friends').data('is_loading_more',false);});}},load_data:function(callback){OF.api.request('/xp/friends',{params:{user_id:OF.page.user.id,page:$('#friends').data('next_page'),per_page:10,for_friends_list_page_optimization:true},success:function(data){if($('#friends').data('next_page')==1){OF.friendsList.renderFriends(data.users);$('#friends').data('total_pages',data.total_pages);}else{OF.friendsList.addFriends(data.users);}\n$('#friends').data('next_page',$('#friends').data('next_page')+1);callback();}});},renderFriendItems:function(friends){var html=$.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));$(\"#friends_list .no_data\").hide();}else{$('#friends_list > ul').hide();$(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));}};}\n$('#home_button').touch(OF.menu.home);var userID=OF.page.params.user_id||OF.user.id;var friendsCount=OF.user.friendship_count\nvar gameID=OF.page.params.game_id||OF.game.id;var leaderboardID=OF.page.params.leaderboard_id;var mark=true;OF.page.params.show_blobs=(gameID===OF.game.id);var name=OF.page.params.leaderboard_name;var scoreTmpl=tmpl('score_tmpl');var everyoneRequest=null;var myScoreRequest=null;var friendScoreRequest=null;if(!name){OF.api.request('/xp/games/'+gameID+'/leaderboards/'+leaderboardID,{method:'GET',success:function(data){if(data.leaderboard.name.length>0){OF.forceSetTitle(data.leaderboard.name);}}});}else{OF.page.title=name}\nvar load=function(interval,tab,tab1){$(tab).addClass(\"active\");$(tab1).addClass(\"current\");if(everyoneRequest)everyoneRequest.cancel();if(myScoreRequest)myScoreRequest.cancel();if(friendScoreRequest)friendScoreRequest.cancel();$(\"section.scores\").addClass(\"hidden\");$(\"section.scores ul\").remove();$(\"#no_data\").addClass(\"hidden\").hide();$(\".loading\").show();var rankScores=function(scores){var rank=0;$.each(scores,function(){if(!this.high_score.rank)this.high_score.rank=++rank;});}\nvar renderScores=function(scoresObject,tab){$(\"#you\").unhide();$('.loading').hide();if(scoresObject.you==null||scoresObject.you.length==0){mark=false;$('#you p').remove();$(\"#you\").append(\"<p style='color:#fff'>\u4f60\u8fd8\u672a\u6210\u529f\u4e0a\u4f20\u8fc7\u5206\u6570\uff0c\u518d\u63a5\u518d\u5389\u54e6</p>\");}else{mark=true;}\nif(tab=='#everyone_tab'){$(\"#everyone\").unhide();$(\"#your_friends\").hide();$(\"#near\").hide();if(scoresObject.everyone==null||scoresObject.everyone.length==0){$('#footer').css('margin-top','90px');$('#everyone p').remove();if(mark){$(\"#everyone\").append(\"<p style='color:#fff'>\u8be5\u6392\u884c\u699c\u6682\u65e0\u5206\u6570</p>\");}else{$(\"#everyone\").append(\"<p style='color:#fff'>\u8be5\u699c\u5355\u6682\u65e0\u4eba\u4e0a\u699c\uff0c\u8d76\u5feb\u6210\u4e3a\u4e0a\u699c\u7b2c\u4e00\u4eba\u5427\uff01</p>\");}}}else if(tab=='#friends_tab'){$(\"#your_friends\").unhide();$(\"#everyone\").hide();$(\"#near\").hide();if(scoresObject.your_friends==null||scoresObject.your_friends.length==0){$('#your_friends p').remove();$('#footer').css('margin-top','80px');if(mark){$(\"#your_friends\").append(\"<p style='color:#fff'>\u597d\u53cb\u8fd8\u672a\u4e0a\u4f20\u8fc7\u5206\u6570\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b\u5168\u90e8\u6e38\u620f\u7528\u6237\u7684\u6392\u540d</p>\");}else{$(\"#your_friends\").append(\"<p style='color:#fff'>\u597d\u53cb\u699c\u5355\u6682\u65e0\u4eba\u4e0a\u699c\uff0c\u8d76\u5feb\u6210\u4e3a\u4e0a\u699c\u7b2c\u4e00\u4eba\u5427\uff01</p>\");}}}else if(tab=='#near_tab'){$(\"#near\").unhide();$(\"#your_friends\").hide();$(\"#everyone\").hide();if(scoresObject.near==null||scoresObject.near.length==0){$('#near p').remove();$('#footer').css('margin-top','80px');if(mark){$(\"#near\").append(\"<p style='color:#fff'>\u60a8\u9644\u8fd1\u8fd8\u672a\u6709\u73a9\u5bb6\u4e0a\u4f20\u8fc7\u5206\u6570\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b\u5168\u90e8\u6e38\u620f\u7528\u6237\u7684\u6392\u540d</p>\");}else{$(\"#near\").append(\"<p style='color:#fff'>\u9644\u8fd1\u699c\u5355\u6682\u65e0\u4eba\u4e0a\u699c\uff0c\u8d76\u5feb\u6210\u4e3a\u4e0a\u699c\u7b2c\u4e00\u4eba\u5427\uff01</p>\");}}}\n$.each(scoresObject,function(section,scores){if(scores.length==0||scores==null){return;}\nvar html='';$.each(scores,function(){if(this.high_score.display_text&&$.trim(this.high_score.display_text).length>0){this.high_score.display_score=this.high_score.display_text;}else{this.high_score.display_score=this.high_score.score;}\nhtml+=scoreTmpl(this.high_score);});var ul=$(\"<ul class='cells scores'>\").html(html);$('#'+section).append(ul).unhide();});var buttons=$('.share_button');$.each(buttons,function(){if($(this).attr(\"id\")==OF.user.id){$(this).show();}});}\nvar checkForData=function(tab){if(tab=='#everyone_tab'){scores.your_friends=[];scores.near=[];}else if(tab=='#friends_tab'){scores.everyone=[];scores.near=[];}else if(tab=='#near_tab'){scores.your_friends=[];scores.everyone=[];}\nrenderScores(scores,tab);}\nvar baseParams=function(){interval>0?{interval:interval}:{};}\nvar scores={everyone:null,your_friends:null,near:null,you:null,};if(tab==\"#friends_tab\"){friendScoreRequest=OF.api.request('/xp/games/'+gameID+'/leaderboards/'+leaderboardID+'/high_scores',{success:function(data){$('#your_friends p').remove();rankScores(data.high_scores);if(data.high_scores.length==1&&data.high_scores[0].high_score.user.id==userID){scores.your_friends=[];}else{scores.your_friends=data.high_scores;}\nif(data.high_score){$('#you p').remove();scores.you=[data.high_score];}else{scores.you=[]}\ncheckForData(tab);},failure:function(){scores.your_friends=[];checkForData(tab);},params:$.extend(baseParams(),{friends_leaderboard:true},{time_stampe:tab1})});}else if(tab==\"#everyone_tab\"){everyoneRequest=OF.api.request('/xp/games/'+gameID+'/leaderboards/'+leaderboardID+'/high_scores',{success:function(data){$('#everyone p').remove();rankScores(data.high_scores);scores.everyone=data.high_scores;if(data.high_score){$('#you p').remove();scores.you=[data.high_score];}else{scores.you=[]}\ncheckForData(tab);},failure:function(){scores.everyone=[];checkForData(tab);},params:$.extend(baseParams(),{friends_leaderboard:false},{time_stampe:tab1})});}else if(tab==\"#near_tab\"){everyoneRequest=OF.api.request('/xp/games/'+gameID+'/leaderboards/'+leaderboardID+'/high_scores',{success:function(data){$('#near p').remove();rankScores(data.high_scores);if(data.high_scores.length==1&&data.high_scores[0].high_score.user.id==userID){scores.near=[];}else{scores.near=data.high_scores;}\nmyScoreRequest=OF.api.request('/xp/users/'+userID+'/games/'+gameID+'/leaderboards/'+leaderboardID+'/current_score',{success:function(d){$('#you p').remove();scores.you=[d];checkForData(tab);},failure:function(){scores.you=[];checkForData(tab);},params:$.extend(baseParams(),{friends_leaderboard:'near'},{time_stampe:tab1})});},failure:function(){scores.near=[];checkForData(tab);},params:$.extend(baseParams(),{friends_leaderboard:'near'},{time_stampe:tab1})});}}\nOF.page.initTabs=function(){if(friendsCount>0){load(0,\"#friends_tab\",\"#this_all\");}else{load(0,\"#everyone_tab\",\"#this_all\");}\n$('#tabbed_friend_navigation .tab').touch(function(){$('#tabbed_friend_navigation .tab').removeClass(\"active\");$('#you ul,#you p').remove();if($(\"#today\").hasClass(\"current\")){var tabSecond=\"#today\"}else if($(\"#this_week\").hasClass(\"current\")){var tabSecond=\"#this_week\"}else if($(\"#this_month\").hasClass(\"current\")){var tabSecond=\"#this_month\"}else if($(\"#this_all\").hasClass(\"current\")){var tabSecond=\"#this_all\"}\nif(this.id==\"friends_tab\"){$('#everyone').hide();$('#near').hide();$('#your_friends ul,#your_friends p').remove();load(0,\"#friends_tab\",tabSecond);}else if(this.id==\"everyone_tab\"){$('#your_friends').hide();$('#near').hide();$('#everyone ul,#everyone p').remove();load(0,\"#everyone_tab\",tabSecond);}else{$('#everyone').hide();$('#your_friends').hide();$('#near ul,#near p').remove();load(0,\"#near_tab\",tabSecond);}});$('#tabbed_time_options ul li').touch(function(){$('#tabbed_time_options ul li').removeClass(\"current\");if($(\"#friends_tab\").hasClass(\"active\")){var tabFirst=\"#friends_tab\"}else if($(\"#everyone_tab\").hasClass(\"active\")){var tabFirst=\"#everyone_tab\"}else if($(\"#near_tab\").hasClass(\"active\")){var tabFirst=\"#near_tab\"}\nif(this.id==\"today\"){load(0,tabFirst,\"#today\");}else if(this.id==\"this_week\"){load(0,tabFirst,\"#this_week\");}else if(this.id==\"this_month\"){load(0,tabFirst,\"#this_month\");}else if(this.id==\"this_all\"){load(0,tabFirst,\"#this_all\");}});};$('.share_button').touch(function(){var rank=$(this).attr('rank');var game_id=gameID;OF.navigateToUrl('dashboard/shareto',{params:{gameid:game_id,leaderboard_id:leaderboardID,rank:rank}});});OF.page.initTabs();","resume":"\nOF.setActiveFootermenu();","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"score_tmpl\">\n            <li class=\"high_score\" data-href=\"dashboard/user?user_id=<%= user.id %>\"<% if((typeof blob_url != \"undefined\") && OF.page.params.show_blobs) {%> style=\"margin-right:70px\"<% } %>>\n  <div class=\"icon\" <% if (user.profile_picture_url) { %> style=\"background-image: url(<%= user.profile_picture_url %>)\" <% } %>>\n    <div class=\"overlay\"></div>\n  </div>\n  <div class=\"title ranktitle\">\n    <% if (typeof rank != \"undefined\" && (rank == '1' || rank == '2' || rank == '3')) { %>\n      <p class=\"leaderboard_rank leaderboard_rank_<%= rank %>\" style=\"margin:0px\"><span class=\"user_name truncate\"><%= user.name %></span></p>\n    <% }else if(typeof rank != \"undefined\") { %>\n      <span class=\"rank\"><%= rank %></span>\n      <span class=\"user_name truncate\"><%= user.name %></span>\n    <% } %>\n    <div style=\"display:none\" class=\"share_button\" rank=\"<%= rank %>\" id=\"<%= user.id %>\"></div>\n    <div class=\"subtitle\" style=\"line-height: 30px\">\n      <span class=\"experience_level\">Lv<%= user.experience_level %></span>\n      <span id=\"gem_icon\">\n      <img height=\"20\" width=\"20\" src=\"images/icon.brisks.level.<%= user.experience_level %>.png\">\n      </span>\n      <span style=\"float:right;\"><%= display_score %></span>\n    </div>\n    <div class=\"subtitle\">\u4e0a\u4f20\u65f6\u95f4: <%= updated_at %></div>\n  </div>\n  \n</li>\n          </script>\n<!-- /  <% if((typeof blob_url != \"undefined\") && OF.page.params.show_blobs) { %> -->\n<!-- /    <li class=\"icon high_score_blob_icon\" data-high_score='<%= JSON.stringify({high_score: obj}) %>'> -->\n<!-- /      <div class=\"button\"> -->\n<!-- /        <div class=\"icon\"/> -->\n<!-- /      </div> -->\n<!-- /    </li> -->\n<!-- /  <% } %> -->\n<div id='leaderboard'>\n<section class='tabbed_friend_arrow' id='tabbed_friend_navigation'>\n<ul class='tabs'>\n<li class='tab' id='friends_tab'>\n<div class='arrow'></div>\n<div class='label'>\u597d\u53cb</div>\n</li>\n<li class='tab' id='everyone_tab'>\n<div class='arrow'></div>\n<div class='label'>\u5168\u90e8</div>\n</li>\n<br clear='both'>\n</ul>\n</section>\n<section id='tabbed_time_options'>\n<ul>\n<li id='today'>\n<div class='label'>\u4eca\u5929</div>\n</li>\n<li id='this_week'>\n<div class='label'>\u672c\u5468</div>\n</li>\n<li id='this_month'>\n<div class='label'>\u672c\u6708</div>\n</li>\n<li id='this_all'>\n<div class='label'>\u5168\u90e8</div>\n</li>\n<br clear='both'>\n</ul>\n</section>\n<section class='scores hidden' id='you'>\n<h3 class='section_title'>\u6211\u7684\u6392\u540d</h3>\n</section>\n<section class='scores hidden' id='your_friends'>\n<h3 class='section_title'>\u597d\u53cb\u7684\u6392\u884c\u699c</h3>\n</section>\n<section class='scores hidden' id='everyone'>\n<h3 class='section_title'>\u6240\u6709\u4eba\u7684\u6392\u884c\u699c</h3>\n</section>\n<section class='scores hidden' id='near'>\n<h3 class='section_title'>\u9644\u8fd1\u6240\u6709\u4eba\u7684\u6392\u884c\u699c</h3>\n</section>\n<div class='cell loading'>\n<div class='spinner'></div>\n</div>\n</div>\n\n<br clear='both'>\n<div id='footer'>\n<div class='footer_menu' id='footer_menu_for_2_1' style='display:none'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n<br clear='both'>\n<div class='footer_menu' id='footer_menu_for_2_2'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n"}