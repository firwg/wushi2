{"title":"Feint Friends","scrolling":true,"loadflow":"","init":"\nOF.setActiveFootermenu();OF.setFootermenu();$('body').addClass('textured');$('.button').pretouch();if(!OF.friendsList){OF.friendsList={init:function(){$('#friends').data('total_pages',1);$('#friends').data('next_page',1);$('#friends').data('is_loading_more',false);$('#load_more').hide();$('#friends_list > ul .user').remove();$('#friends ul#loading').unhide();OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}else{$(\"#load_more\").unhide();}\n$(\"#friends ul#loading\").hide();});},load_more:function(){if(!$('#friends').data('is_loading_more')){$('#friends').data('is_loading_more',true);$(\"#load_more\").html(\"\u8bfb\u53d6\u4e2d....\");OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}\n$(\"#load_more\").html(\"\u8bfb\u53d6\u66f4\u591a\");$('#friends').data('is_loading_more',false);});}},load_data:function(callback){OF.api.request('/xp/friends',{params:{user_id:OF.page.user.id,page:$('#friends').data('next_page'),per_page:10,for_friends_list_page_optimization:true},success:function(data){if($('#friends').data('next_page')==1){OF.friendsList.renderFriends(data.users);$('#friends').data('total_pages',data.total_pages);}else{OF.friendsList.addFriends(data.users);}\n$('#friends').data('next_page',$('#friends').data('next_page')+1);callback();}});},renderFriendItems:function(friends){var html=$.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));$(\"#friends_list .no_data\").hide();}else{$('#friends_list > ul').hide();$(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));}};}\n$('#home_button').touch(OF.menu.home);var friendables=new Array();var users_count=0;var PENDING_LABEL='\u8bf7\u6c42\u5df2\u53d1\u9001';$('.add_friend_button').touch(function(){var friend_id=this.id;$(this).addClass('disabled');$(this).text(PENDING_LABEL);OF.api.request('/xp/addtx_friends',{background:true,method:'POST',params:{friend_id:friend_id},loader:'#loading .loading',success:function(data){var index_to_remove=friendables.indexOf(Number(friend_id));if(index_to_remove!=-1)friendables.splice(index_to_remove,1);if((friendables.length<1)&&(users_count>1)){$('#add_all_friends_button').addClass('disabled').val(PENDING_LABEL);}}});});$('#add_all_friends_button').touch(function(){$(this).hide();$('.add_friend_button').addClass('disabled').text(PENDING_LABEL);OF.api.request('/xp/addtx_friends',{method:'POST',params:{friend_ids:friendables},loader:'#loading .loading',success:function(data){$('#find_friends').addClass('hidden');$('#all_requests_sent').removeClass('hidden');$('#submit').addClass('hidden');}});});$('#submit').touch(function(){OF.api.request('/xp/txlogout',{method:'PUT',loader:'#submit',success:function(){OF.goBack();}});});OF.api.request('/xp/tencent/getuserinfo',{background:true,method:'GET',success:function(data){$('#tx_friend_count_bar .icon').css('background-image','url('+data.weibouser.pic_url+')');$('#tx_friend_count_bar #weibo_friends_count').text(data.weibouser.weiboname);}});OF.api.request('/xp/txlist',{loader:'#loading .loading',success:function(data){var userTmpl=tmpl('a_tx_user');var html=[];users_count=data.users.length;if(users_count>0){$.each(data.users,function(){html.push(userTmpl(this));friendables.push(this.id);});$('ul#friends_list').append(html.join(\"\"));$('#tx_friend_count_bar').unhide();if(users_count>2){$('#add_all_friends_button').unhide();}}else{$('#no_friends_found').unhide();}},failure:function(data,status){$('#no_friends_found').unhide();}});","resume":"\nOF.setActiveFootermenu();","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"a_tx_user\">\n            <% var style = \"\"; %>\n<% if(tx_pic){ style = \"background-image: url(\" + tx_pic + \")\" } %>\n<% var btnval = \"\u52a0\u4ed6/\u5979\"; %>\n\n\n<li class=\"user\">\n  <div id=\"<%= id %>\" class=\"button add_friend_button\"><%= btnval %></div>\n  <div class=\"image useravatar\" style=\"<%= style %>\">\n    <div class=\"overlay\"></div>\n  </div>\n  <div class=\"title feint_name\"><%= feint_name %></div>\n  <div class=\"tx_weibo_name\"><%= tx_weibo_name %></div>\n</li>\n          </script>\n<div id='friends'>\n<section id='find_friends'>\n<h3 class='section_title t'>\u817e\u8baf\u5fae\u535a</h3>\n<div id='tx_friend_count_bar'>\n<div class='cell'>\n<div class='button' id='submit'>\u5e10\u53f7\u89e3\u7ed1</div>\n<div class='icon'></div>\n<div class='content'>\n<div id='weibo_friends_count'></div>\n</div>\n</div>\n</div>\n<h3 class='section_title'>\u817e\u8baf\u5fae\u535a\u4e0a\u7684\u597d\u53cb</h3>\n<ul class='cells' id='friends_list'></ul>\n<div class='hidden' id='no_friends_found'>\n<div class='cell'>\n\u60a8\u7684\u817e\u8baf\u5fae\u535a\u597d\u53cb\u6ca1\u6709\u7ed1\u5b9a\u7684\u4e5d\u57ce\u6e38\u620f\u4e2d\u5fc3. \u8bf7\u901a\u8fc7\u7528\u6237\u540d\u67e5\u627e.\n</div>\n<div class='cell one_line' data-href='dashboard/user_search'>\n<div class='icon'></div>\n<div class='title t'>Search by Feint Name</div>\n</div>\n</div>\n</section>\n<section class='hidden' id='all_requests_sent'>\n<h3 class='section_title'>\u817e\u8baf\u5fae\u535a\u4e0a\u7684\u597d\u53cb</h3>\n<div id='all_requests_sent' style='color: #333'>\n<div class='cell'>\u60a8\u7684\u597d\u53cb\u8bf7\u6c42\u5df2\u53d1\u9001!</div>\n</div>\n</section>\n<div class='button hidden t' id='add_all_friends_button'>\u5168\u9009</div>\n<ul class='cells' id='loading'>\n<li class='loading'>\n<div class='spinner'></div>\n</li>\n</ul>\n</div>\n\n<br clear='both'>\n<div id='footer'>\n<div class='footer_menu' id='footer_menu_for_2_1' style='display:none'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n<br clear='both'>\n<div class='footer_menu' id='footer_menu_for_2_2'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n"}