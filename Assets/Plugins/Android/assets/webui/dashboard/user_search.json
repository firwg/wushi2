{"title":"Friends","scrolling":true,"loadflow":"","init":"\nOF.setActiveFootermenu();OF.setFootermenu();$('body').addClass('textured');$('.button').pretouch();if(!OF.friendsList){OF.friendsList={init:function(){$('#friends').data('total_pages',1);$('#friends').data('next_page',1);$('#friends').data('is_loading_more',false);$('#load_more').hide();$('#friends_list > ul .user').remove();$('#friends ul#loading').unhide();OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}else{$(\"#load_more\").unhide();}\n$(\"#friends ul#loading\").hide();});},load_more:function(){if(!$('#friends').data('is_loading_more')){$('#friends').data('is_loading_more',true);$(\"#load_more\").html(\"\u8bfb\u53d6\u4e2d....\");OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}\n$(\"#load_more\").html(\"\u8bfb\u53d6\u66f4\u591a\");$('#friends').data('is_loading_more',false);});}},load_data:function(callback){OF.api.request('/xp/friends',{params:{user_id:OF.page.user.id,page:$('#friends').data('next_page'),per_page:10,for_friends_list_page_optimization:true},success:function(data){if($('#friends').data('next_page')==1){OF.friendsList.renderFriends(data.users);$('#friends').data('total_pages',data.total_pages);}else{OF.friendsList.addFriends(data.users);}\n$('#friends').data('next_page',$('#friends').data('next_page')+1);callback();}});},renderFriendItems:function(friends){var html=$.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));$(\"#friends_list .no_data\").hide();}else{$('#friends_list > ul').hide();$(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));}};}\n$('#home_button').touch(OF.menu.home);var prompt=_('Search by Feint Name');var field=$('#username_field');field.focus(function(){field.removeClass('prompt');if(field.val()==prompt){field.val('');}});field.blur(function(){if($.trim(field.val()).length==0){field.val(prompt).addClass('prompt');}});field.blur();$('#search_submit').touch(function(){$('li.user').fadeOut();var username=$('#username_field').val();if(username.length>0&&username!=prompt){$('#friends_list').unhide();OF.api.request('/xp/friends/search',{params:{name:username},loader:'#friends_list .loading',success:function(data){if(data.users.length>0){var userTmpl=tmpl('user_tmpl');var html=[];$.each(data.users,function(){html.push(userTmpl(this));});$('li.user').remove();$('#friends_list').append(html.join('')).removeClass('hidden').unhide();}else{OF.alert(_('No users'),_('Unable to find any users by that name.'));}},});}else{OF.alert(_('Invalid name'),_('Please enter a user name to search for friends.'));}});$('form').submit(function(){$('#search_submit').touch();return false;});","resume":"\nOF.setActiveFootermenu();","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"user_tmpl\">\n            <%\n  var style = \"\";\n  if (user.profile_picture_url) {\n    style = \"background-image: url(\" + user.profile_picture_url + \")\";\n  }\n%>\n\n<li class=\"user\" data-href=\"dashboard/user?user_id=<%= user.id %>\" style=\"height:90px;min-height:90px\">\n  <div class=\"image avatar\" style=\"<%= style %>\">\n    <div class=\"overlay\"></div>\n  </div>\n  <div class=\"title user_name\"><%= user.name %></div>\n  <div>\n     <span class=\"experience_level\">Lv<%=user.experience_level %></span>\n     <span style=\"float:left\" id=\"gem_icon\"><img src=\"images/icon.brisks.level.<%=user.experience_level %>.png\" width=\"20\" height=\"20\"></span>\n     <span class=\"gamerscore_val\"><%=user.gamer_experience %></span>\n     <span class=\"gamerscore_exp\"></span>\n  </div>\n  <div class=\"last_play\" style=\"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:250px\">\u6700\u8fd1\u5728\u73a9\uff1a<%= user.recent_play_game %></div>\n</li>\n          </script>\n<div id='friends'>\n<ul class='cells'>\n<li class='section_title t'>Find Friends</li>\n<li class='liquid' id='search_cell'>\n<form>\n<!-- / I know... Really, I know :( -->\n<table>\n<tr>\n<td>\n<div class='input_field'>\n<input id='username_field' type='text'>\n</div>\n</td>\n<td class='button_cell'>\n<div class='input_field'>\n<div class='button' id='search_submit'>\n<div class='icon'></div>\n&nbsp;\n</div>\n</div>\n</td>\n</tr>\n</table>\n</form>\n</li>\n<li class='section_title t'>Results</li>\n</ul>\n<ul class='cells hidden' id='friends_list'>\n<li class='loading'>\n<div class='spinner'></div>\n</li>\n</ul>\n</div>\n\n<br clear='both'>\n<div id='footer'>\n<div class='footer_menu' id='footer_menu_for_2_1' style='display:none'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n<br clear='both'>\n<div class='footer_menu' id='footer_menu_for_2_2'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n"}