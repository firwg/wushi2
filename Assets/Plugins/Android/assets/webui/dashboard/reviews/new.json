{"title":"\u6e38\u620f","scrolling":true,"loadflow":"","init":"\nOF.setActiveFootermenu();OF.setFootermenu();$('body').addClass('textured');$('.button').pretouch();if(!OF.friendsList){OF.friendsList={init:function(){$('#friends').data('total_pages',1);$('#friends').data('next_page',1);$('#friends').data('is_loading_more',false);$('#load_more').hide();$('#friends_list > ul .user').remove();$('#friends ul#loading').unhide();OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}else{$(\"#load_more\").unhide();}\n$(\"#friends ul#loading\").hide();});},load_more:function(){if(!$('#friends').data('is_loading_more')){$('#friends').data('is_loading_more',true);$(\"#load_more\").html(\"\u8bfb\u53d6\u4e2d....\");OF.friendsList.load_data(function(){if($('#friends').data('next_page')>$('#friends').data('total_pages')){$(\"#load_more\").hide();}\n$(\"#load_more\").html(\"\u8bfb\u53d6\u66f4\u591a\");$('#friends').data('is_loading_more',false);});}},load_data:function(callback){OF.api.request('/xp/friends',{params:{user_id:OF.page.user.id,page:$('#friends').data('next_page'),per_page:10,for_friends_list_page_optimization:true},success:function(data){if($('#friends').data('next_page')==1){OF.friendsList.renderFriends(data.users);$('#friends').data('total_pages',data.total_pages);}else{OF.friendsList.addFriends(data.users);}\n$('#friends').data('next_page',$('#friends').data('next_page')+1);callback();}});},renderFriendItems:function(friends){var html=$.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));$(\"#friends_list .no_data\").hide();}else{$('#friends_list > ul').hide();$(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);$(html.join(\" \")).insertBefore($(\"#friends_list > ul #load_more\"));}};}\n$('#home_button').touch(OF.menu.home);var gameID=OF.page.params.game_id\nvar IsPosting=false;var check_login=function(){if(OF.user.id==null){$(\"#not_local_user_tip\").unhide();}else{$(\"#not_local_user_tip\").hide();}}\nvar get_review_date=function(){var field=$('#review_content');field.val($.trim(field.val()));OF.page.params.review_content=field.val();var rating_field=$('div.current-rating');var rating=$.trim(rating_field.html());OF.page.params.rating=rating;}\nif(OF.page.params.rating_count!=null){$.each($(\".star-rating div\"),function(){var rating_count=$(this).html();if($.trim(rating_count)==OF.page.params.rating_count){$(this).addClass(\"current-rating\");}});}\nif(OF.page.params.review_content!=null){$('#review_content').val(OF.page.params.review_content);}\ncheck_login();$('#new_review_form').submit(function(){IsPosting=false;var field=$('#review_content');field.val($.trim(field.val()));var review_content=field.val();var rating_field=$('div.current-rating');var rating=$.trim(rating_field.html())+\"\";if(review_content.length&&rating!=0){OF.api('/xp/games/'+gameID+\"/reviews\",{method:'POST',params:{game_id:gameID,body:review_content,rating_count:rating},success:function(){OF.push('dashboard/reviews/index',{params:{game_id:gameID}});},failure:function(response){$(\".loading\").hide();var message=response.exception.message;OF.alert(_('Error'),message);}});}else{$(\".loading\").hide();OF.alert(_('Missing Data'),\"\u8bf7\u8f93\u5165\u8bc4\u8bba\u8bc4\u5206\u4e0e\u5185\u5bb9\uff0c\u5185\u5bb9\u5927\u5c0f\u8bf7\u63a7\u5236\u572870\u4ee5\u5185\");}\nreturn false;});$(\".star-rating li\").touch(function(){$(\".star-rating li\").find(\"div\").removeClass(\"current-rating\");$(this).find(\"div\").addClass('current-rating');});$('#submit').touch(function(){if(OF.user.id==null){get_review_date();OF.sendAction('requireLoginWithReturn',{redirect_screen:\"reviews/new\",game_id:gameID,review_content:OF.page.params.review_content,rating_count:OF.page.params.rating,to_screen:'index'});}else{if(IsPosting==false){IsPosting=true;$(\".loading\").unhide();$('#new_review_form').submit();}else{OF.alert(\"\u64cd\u4f5c\u63d0\u9192\",\"\u6b63\u5728\u63d0\u4ea4\u8bc4\u8bba\uff0c\u8bf7\u7a0d\u5019\uff01\");}}});$(\"#cancel\").touch(function(){OF.api('/xp/games/'+gameID,{background:true,success:function(data){OF.push('dashboard/game',{params:{game:data.game}});}});});$(\"#login\").touch(function(){get_review_date();OF.sendAction('requireLoginWithReturn',{redirect_screen:\"reviews/new\",game_id:gameID,review_content:OF.page.params.review_content,rating_count:OF.page.params.rating});});$(\"#create_new_account\").touch(function(){get_review_date();OF.sendAction('requireLoginWithReturn',{redirect_screen:\"reviews/new\",game_id:gameID,review_content:OF.page.params.review_content,rating_count:OF.page.params.rating,to_screen:'index',for_new_account:\"true\"});});","resume":"\nOF.setActiveFootermenu();$(\".loading\").hide();$(\"#review_content\").val(\" \")\n$(\".star-rating div\").removeClass(\"current-rating\");","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n<div id='new_review'>\n<ul class='cells'>\n<li class='section_title'>\u6211\u7684\u8bc4\u8bba</li>\n</ul>\n<div class='hidden' id='not_local_user_tip'>\n\u63d0\u793a\uff1a\u60a8\u5f53\u524d\u5904\u4e8e\u672a\u767b\u5f55\u72b6\u6001\uff0c\u767b\u5f55\u540e\u624d\u80fd\u5bf9\u6e38\u620f\u8fdb\u884c\u8bc4\u4ef7\u3002\n<div class='login_tip'>\n<span id='create_new_account'>\u6ce8\u518c\u65b0\u8d26\u53f7</span>\n|\n<span id='login'>\u7528\u8001\u8d26\u53f7\u767b\u5f55</span>\n</div>\n</div>\n</div>\n<form id='new_review_form' style='margin:20px;'>\n<div class='input_field'>\n<label>\u8bc4\u5206:</label>\n<ul class='star-rating'>\n<li>\n<div class='one-star-unit'>1</div>\n</li>\n<li>\n<div class='two-star-unit'>2</div>\n</li>\n<li>\n<div class='three-star-unit'>3</div>\n</li>\n<li>\n<div class='four-star-unit'>4</div>\n</li>\n<li>\n<div class='five-star-unit'>5</div>\n</li>\n<li>\n<div class='six-star-unit'>6</div>\n</li>\n<li>\n<div class='seven-star-unit'>7</div>\n</li>\n<li>\n<div class='eight-star-unit'>8</div>\n</li>\n<li>\n<div class='nine-star-unit'>9</div>\n</li>\n<li>\n<div class='ten-star-unit'>10</div>\n</li>\n</ul>\n</div>\n<div class='input_field'>\n<label>\u5185\u5bb9:</label>\n<textarea id='review_content' name='review[body]' placeholder='\u586b\u5199\u8bc4\u8bba'></textarea>\n</div>\n<div class='button_row'>\n<div class='button_wrapper'>\n<div class='button t' id='submit'>\n\u63d0\u4ea4\n</div>\n</div>\n<div class='button_wrapper'>\n<div class='button t' id='cancel'>\n\u53d6\u6d88\n</div>\n</div>\n</div>\n<br clear='both'>\n<div class='loading hidden' style='list-style:none;'>\n<div class='spinner'></div>\n</div>\n</form>\n\n<br clear='both'>\n<div id='footer'>\n<div class='footer_menu' id='footer_menu_for_2_1' style='display:none'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n<br clear='both'>\n<div class='footer_menu' id='footer_menu_for_2_2'>\n<ul class='footer_tabs'>\n<li class='footer_tab active'>\n<label class='user_tab'>\u6211\u7684\u7a7a\u95f4</label>\n<div class='right_bar'></div>\n</li>\n<li class='footer_tab' style='border-right:none'>\n<label class='game_tab'>\u6e38\u620f\u63a8\u8350</label>\n<div class='right_bar'></div>\n</li>\n</ul>\n</div>\n</div>\n"}